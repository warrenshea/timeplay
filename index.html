<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Timeplay - Player</title>
    <link href="//fonts.googleapis.com/css?family=Exo+2" rel="stylesheet">
    <link href="styles.css" rel="stylesheet" type="text/css">
  </head>
  <body class="player">

    <div id="alert" class="centered">
      <br>
      <br>
      <br>
      <br>
      <h2>Please wait for<br>timeplay to start !</h2>
    </div>

    <div id="avatar-selection" class="centered">
      <div class="avatar-hidden">Show Avatar</div>
      <div class="avatar-shown centered">
        <div class="selected-avatar"><div class="avatar40 avatar-icon"></div></div>
      </div>
      <div class="avatar-show">Hide Your Avatar</div>
      <div>
        <button form="form-pick-avatar" type="submit" name="submit" value="Confirm">Confirm</button>
      </div>
    </div>

    <section id="pick-your-avatar">
      <div class="avatar-instructions centered">Choose your <b>secret</b> avatar</div>
      <form id="form-pick-avatar" name="pickAvatar">
      <div class="avatar-icon-container">
        <input type="radio" id="avatar0" value="0" name="avatar">
        <label for="avatar0"><div class="avatar0 avatar-icon"></div></label>
        <input type="radio" id="avatar1" value="1" name="avatar">
        <label for="avatar1"><div class="avatar1 avatar-icon"></div></label>
        <input type="radio" id="avatar2" value="2" name="avatar">
        <label for="avatar2"><div class="avatar2 avatar-icon"></div></label>
        <input type="radio" id="avatar3" value="3" name="avatar">
        <label for="avatar3"><div class="avatar3 avatar-icon"></div></label>
        <input type="radio" id="avatar4" value="4" name="avatar">
        <label for="avatar4"><div class="avatar4 avatar-icon"></div></label>
        <input type="radio" id="avatar5" value="5" name="avatar">
        <label for="avatar5"><div class="avatar5 avatar-icon"></div></label>
        <input type="radio" id="avatar6" value="6" name="avatar">
        <label for="avatar6"><div class="avatar6 avatar-icon"></div></label>
        <input type="radio" id="avatar7" value="7" name="avatar">
        <label for="avatar7"><div class="avatar7 avatar-icon"></div></label>
        <input type="radio" id="avatar8" value="8" name="avatar">
        <label for="avatar8"><div class="avatar8 avatar-icon"></div></label>
        <input type="radio" id="avatar9" value="9" name="avatar">
        <label for="avatar9"><div class="avatar9 avatar-icon"></div></label>
        <input type="radio" id="avatar10" value="10" name="avatar">
        <label for="avatar10"><div class="avatar10 avatar-icon"></div></label>
        <input type="radio" id="avatar11" value="11" name="avatar">
        <label for="avatar11"><div class="avatar11 avatar-icon"></div></label>
        <input type="radio" id="avatar12" value="12" name="avatar">
        <label for="avatar12"><div class="avatar12 avatar-icon"></div></label>
        <input type="radio" id="avatar13" value="13" name="avatar">
        <label for="avatar13"><div class="avatar13 avatar-icon"></div></label>
        <input type="radio" id="avatar14" value="14" name="avatar">
        <label for="avatar14"><div class="avatar14 avatar-icon"></div></label>
        <input type="radio" id="avatar15" value="15" name="avatar">
        <label for="avatar15"><div class="avatar15 avatar-icon"></div></label>
        <input type="radio" id="avatar16" value="16" name="avatar">
        <label for="avatar16"><div class="avatar16 avatar-icon"></div></label>
        <input type="radio" id="avatar17" value="17" name="avatar">
        <label for="avatar17"><div class="avatar17 avatar-icon"></div></label>
        <input type="radio" id="avatar18" value="18" name="avatar">
        <label for="avatar18"><div class="avatar18 avatar-icon"></div></label>
        <input type="radio" id="avatar19" value="19" name="avatar">
        <label for="avatar19"><div class="avatar19 avatar-icon"></div></label>
        <input type="radio" id="avatar20" value="20" name="avatar">
        <label for="avatar20"><div class="avatar20 avatar-icon"></div></label>
        <input type="radio" id="avatar21" value="21" name="avatar">
        <label for="avatar21"><div class="avatar21 avatar-icon"></div></label>
        <input type="radio" id="avatar22" value="22" name="avatar">
        <label for="avatar22"><div class="avatar22 avatar-icon"></div></label>
        <input type="radio" id="avatar23" value="23" name="avatar">
        <label for="avatar23"><div class="avatar23 avatar-icon"></div></label>
        <input type="radio" id="avatar24" value="24" name="avatar">
        <label for="avatar24"><div class="avatar24 avatar-icon"></div></label>
        <input type="radio" id="avatar25" value="25" name="avatar">
        <label for="avatar25"><div class="avatar25 avatar-icon"></div></label>
        <input type="radio" id="avatar26" value="26" name="avatar">
        <label for="avatar26"><div class="avatar26 avatar-icon"></div></label>
        <input type="radio" id="avatar27" value="27" name="avatar">
        <label for="avatar27"><div class="avatar27 avatar-icon"></div></label>
        <input type="radio" id="avatar28" value="28" name="avatar">
        <label for="avatar28"><div class="avatar28 avatar-icon"></div></label>
        <input type="radio" id="avatar29" value="29" name="avatar">
        <label for="avatar29"><div class="avatar29 avatar-icon"></div></label>
        <input type="radio" id="avatar30" value="30" name="avatar">
        <label for="avatar30"><div class="avatar30 avatar-icon"></div></label>
        <input type="radio" id="avatar31" value="31" name="avatar">
        <label for="avatar31"><div class="avatar31 avatar-icon"></div></label>
        <input type="radio" id="avatar32" value="32" name="avatar">
        <label for="avatar32"><div class="avatar32 avatar-icon"></div></label>
        <input type="radio" id="avatar33" value="33" name="avatar">
        <label for="avatar33"><div class="avatar33 avatar-icon"></div></label>
        <input type="radio" id="avatar34" value="34" name="avatar">
        <label for="avatar34"><div class="avatar34 avatar-icon"></div></label>
        <input type="radio" id="avatar35" value="35" name="avatar">
        <label for="avatar35"><div class="avatar35 avatar-icon"></div></label>
        <input type="radio" id="avatar36" value="36" name="avatar">
        <label for="avatar36"><div class="avatar36 avatar-icon"></div></label>
        <input type="radio" id="avatar37" value="37" name="avatar">
        <label for="avatar37"><div class="avatar37 avatar-icon"></div></label>
        <input type="radio" id="avatar38" value="38" name="avatar">
        <label for="avatar38"><div class="avatar38 avatar-icon"></div></label>
        <input type="radio" id="avatar39" value="39" name="avatar">
        <label for="avatar39"><div class="avatar39 avatar-icon"></div></label>
      </div>
      </form>
    </section>

    <section id="answers">
      <form name="answers">
      <input type="radio" id="answer0" value="0" name="answer">
      <label for="answer0">A</label>
      <input type="radio" id="answer1" value="1" name="answer">
      <label for="answer1">B</label>
      <input type="radio" id="answer2" value="2" name="answer">
      <label for="answer2">C</label>
      <input type="radio" id="answer3" value="3" name="answer">
      <label for="answer3">D</label>
      </form>
    </section>

    <section id="results" class="centered">
      <br><br><br>
      <h2>Your score was:</h2><br>
      <h1><span class="score"></span>/<span class="numQuestions"></span></h1>
    </section>

    <script src="//cdn.socket.io/4.1.2/socket.io.js"></script>
    <script src="//code.jquery.com/jquery-2.2.4.min.js"></script>
    <script>
      //step 0 - intro to start + avatars
      //step 1 - instructions
      //step 2 - question
      (function(){
        'use strict';
        var socket = io();
        var uid = "";
        var state                = 0,
            stateAlert           = $("#alert"),
            stateAnswers         = $("#answers"),
            stateResults         = $("#results"),
            panelAvatarSelection = $("#avatar-selection"),
            step0AvatarSelection = $("#pick-your-avatar");
        var avatarSelection      = $('form[name="pickAvatar"]'),
            avatarSelectionEl    = avatarSelection.find("input[name=avatar]"),
            avatarSubmitBtn      = $('button[form="form-pick-avatar"]'),
            answersFormEl        = $('form[name="answers"]');

        answersFormEl.on('change', function(e){
          e.preventDefault();
          stateAnswers.find("input").prop("disabled",true);
          stateAnswers.find("label[for=answer" + $('input[name="answer"]:checked').val() + "]").addClass("selected");
          socket.emit('answered', { userid : uid, answer : $('input[name="answer"]:checked').val() });
        });

        socket.on('show question', function(questionID){
          if (uid) {
            stateAlert.hide();
            stateResults.hide();
            stateAnswers.show();
            stateAnswers.find("input").prop("disabled",false);
            stateAnswers.find("input").prop('checked', false);
            stateAnswers.find("label").removeClass("disabled").removeClass("selected").removeClass("correct").removeClass("incorrect");
          }
        });

        socket.on('show answer', function(answer){
          if ($('input[name="answer"]:checked').val() == answer) {
            stateAnswers.find("label[for=answer" + $('input[name="answer"]:checked').val() + "]").removeClass("selected").addClass("correct");
            socket.emit("add my score",uid);
          } else {
            stateAnswers.find("label[for=answer" + $('input[name="answer"]:checked').val() + "]").removeClass("selected").addClass("incorrect");
            stateAnswers.find("label[for=answer" + answer + "]").addClass("correct");
          }
        });

        socket.on('show results page', function(avatarsObj,numberQuestions){
          stateAlert.hide();
          stateAnswers.hide();
          stateResults.show();
          $.each(avatarsObj.players, function() {
            console.log(numberQuestions);
            if (this.uid == uid) {
              stateResults.find(".score").html(this.score);
              stateResults.find(".numQuestions").html(numberQuestions);
            }
          });
        });

        /*request what avatars are taken*/
        socket.emit('update avatar list');

        /*update avatar selection on load - event listener*/
        socket.on('disable these uids', function(avatarsObj){
          $.each(avatarsObj.players,function() {
            $("#avatar" + this.uid).prop("disabled",true);
            $("label[for=avatar" + this.uid + "]").addClass("disabled");
          });
        });

        /*avatar selection - event handler*/
        avatarSelectionEl.on("change", function() {
          panelAvatarSelection.find(".selected-avatar").html($("label[for=avatar" + $("input[name='avatar']:checked").val() + "]").html());
          step0AvatarSelection.find("label").removeClass("selected");
          step0AvatarSelection.find("label[for=avatar" + $("input[name='avatar']:checked").val() + "]").addClass("selected");
          avatarSubmitBtn.val("Confirm");
          avatarSubmitBtn.prop('disabled', false);
        });

        /*avatar form submission - event handler*/
        avatarSelection.on('submit', function(e){
          e.preventDefault();
          uid = $("input[name='avatar']:checked").val();
          if (uid) {
            console.log(uid + ": is this avatar available?");
            socket.emit('is avatar available?', uid );
          }
        });

        /*the avatar was available and is now taken...by you! - event listener*/
        socket.on('avatar is now taken', function(userID){
          $("#avatar" + userID).prop("disabled",true);
          $("label[for=avatar" + userID + "]").addClass("disabled");
          if ($("input[name='avatar']:checked").val() == userID) {
            avatarSubmitBtn.val("This avatar got taken! Choose a new one");
            avatarSubmitBtn.prop('disabled', true);
          }
          if (uid == userID) {
            step0AvatarSelection.hide();
            avatarSubmitBtn.hide();
            stateAlert.show();
            state++;
            panelAvatarSelection.addClass("minimize");
            panelAvatarSelection.find(".avatar-hidden").animate({opacity: "1"});
            panelAvatarSelection.find(".avatar-show").show();
            panelAvatarSelection.find(".avatar-shown").animate({opacity: "0"});
            console.log(userID + " is now taken by you!");
          }
        });

        /*avatar panel - event handler*/
        panelAvatarSelection.on("click", function() {
          if (state > 0) {
            if (panelAvatarSelection.hasClass("minimize")) {
              panelAvatarSelection.removeClass("minimize");
              panelAvatarSelection.addClass("maximize");
              panelAvatarSelection.find(".avatar-hidden").animate({opacity: "0"});
              panelAvatarSelection.find(".avatar-show").animate({opacity: "1"});
              panelAvatarSelection.find(".avatar-shown").animate({opacity: "1"});
            } else {
              panelAvatarSelection.addClass("minimize");
              panelAvatarSelection.removeClass("maximize");
              panelAvatarSelection.find(".avatar-hidden").animate({opacity: "1"});
              panelAvatarSelection.find(".avatar-show").animate({opacity: "0"});
              panelAvatarSelection.find(".avatar-shown").animate({opacity: "0"});
            }
          }
        });
      })();
    </script>
  </body>
</html>
